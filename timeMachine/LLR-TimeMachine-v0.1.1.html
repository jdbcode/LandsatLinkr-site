<!DOCTYPE html>
<html lan="en">
	<head>
		<title>LLR-TimeMachine - LandsatLinkr</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="imgs/favicon.ico" type="image/x-icon">
		<link rel="icon" href="imgs/favicon.ico" type="image/x-icon">
		<meta http-equiv="X-UA-Compatible" content="IE=edge"> <!--needed so that D3 will work in IE!-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="LLR-TimeMachine.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.2.0/imagesloaded.pkgd.min.js"></script>
		<script src="http://maps.googleapis.com/maps/api/js"></script>
		<script>
			var stretch={B1:{mean:604,stdev:670},B2:{mean:827,stdev:410},B3:{mean:903,stdev:555},B4:{mean:2317,stdev:659},B5:{mean:2287,stdev:900},B7:{mean:1611,stdev:829},TCB:{mean:3098,stdev:1247},TCG:{mean:1549,stdev:799},TCW:{mean:-701,stdev:772},TCG:{mean:1549,stdev:799},TCA:{mean:1532,stdev:1002},NDVI:{mean:.4600587,stdev:.1833235},NBR:{mean:.2174783,stdev:.2293639}},domain={B1:{min:-50,max:2e3},B2:{min:-50,max:2e3},B3:{min:-50,max:2500},B4:{min:-50,max:4500},B5:{min:-50,max:4500},B7:{min:-50,max:4e3},TCB:{min:0,max:7e3},TCG:{min:-500,max:2500},TCW:{min:-3500,max:500},TCA:{min:-500,max:4e3},NDVI:{min:-1,max:1},NBR:{min:-1,max:1}};
		</script>
		<script>
			!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});
		</script>
		<style>			
			html,body{width:100%;height:100%;overflow:hidden}body{font-size:11px;min-width:1150px;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.vline{stroke:#e9e9e9;shape-rendering:crispEdges}#btnTsGuide{margin:2px 3px 0px 0px;text-align:center;padding:0px 0px 0px 0px;font-size:11px;height:21.7167px;width:50px;float:right}#chronoGuideBody p,#chronoGuideBody li{font-size:13px}#chipOptionHolder{margin-top:2px;display:inline-block}.chipOptions{display:inline-block;margin-right:15px}#chipSize,#plotSize{width:60px}#zoomSize{display:inline-block;width:75px;margin-bottom:-4px}.colorOptions{width:80px}.colorOptions input{height:17px;width:30px}.axis path,.axis line{fill:none;stroke:black;shape-rendering:crispEdges}.axis text,#specPlotIndex{font-family:sans-serif}#plot{border:1px solid #afafaf;border-radius:4px;width:100%}circle.data{cursor:pointer}circle.selected{stroke:#ED2939;stroke-width:2}circle.highlight{stroke:#32CD32;stroke-width:5}svg{margin:-1px;cursor:n-resize;display:block;width:100%}#plotLine{stroke:#ED2939;stroke-width:2px;fill:none}#chip-gallery{width:auto;height:auto;overflow-y:scroll}.chipHolder{display:inline-block;margin:3px;border:3px solid white;box-shadow:rgba(0, 0, 0, 0.176) 0px 1px 2px 0px}.chipImg{cursor:pointer}.chipDate{text-align:center}#chip-gallery .selected{border:3px solid #ED2939}.chipHolder .highlight{border:3px solid #32CD32}.expandChipYear{visibility:hidden;cursor:pointer}.chipHolder:hover .expandChipYear{visibility:visible}#img-gallery{display:none}.chipImgSrc{display:none}#topSection{margin:3px 3px 0px 3px;box-shadow:rgba(0, 0, 0, 0.176) 1px 1px 1px;vertical-align:top;border:1px solid #afafaf;border-radius:4px}#topSection p{margin-bottom:5px}#title{font-weight:bold;font-size:12px;padding-left:3px;margin:0px 40px 0px 0px}#containerDiv{display:table;border-spacing:3px 3px}#plotSelectionDiv{min-width:55px;width:auto}#plotList{list-style-type:none;padding-left:0px;margin:0px;height:281px;overflow-y:scroll}#plotList li{padding-left:2px;padding-right:2px;cursor:pointer;white-space:nowrap}#plotList .selected{background-color:#dbdbdb}#chipGallerySection{border:1px solid #afafaf;border-radius:4px;margin:0px 3px 0px 3px;box-shadow:rgba(0, 0, 0, 0.176) 1px 1px 1px}.test{text-align:right;margin-top:1px;padding-left:0px;margin-bottom:0px;margin-right:-1px}.test li{width:75px;display:inline-block;font-weight:bold;padding:0px 3px 3px 3px;border:1px solid #afafaf;cursor:pointer}.test li.selected{background-color:#f1f1f1}.header{padding-left:3px;font-size:12px;font-weight:bold;margin-bottom:1px;padding-bottom:3px}.subHeader{padding-left:3px;font-weight:bold;margin-bottom:1px;padding-bottom:3px}.sectionDiv{display:table-cell;vertical-align:top;border:1px solid #afafaf;border-radius:4px;box-shadow:rgba(0, 0, 0, 0.176) 1px 1px 1px}button:focus{outline:none !important}li:hover{background-color:#f1f1f1}.dropdown-menu .active{background-color:#dbdbdb}.dropdown-menu.plot li{font-size:11px;padding-left:5px;cursor:pointer;width:99px}.dropdown-menu.plot{margin-top:0;min-width:0px}.dropdown:hover .dropdown-menu{display:block}.specPlotBtn{border:1px solid #afafaf;font-size:11px;text-align:left;padding:0px 0px 1px 5px;width:100px;height:35px}.buttonText{margin-right:2px}.caret{position:absolute;left:80%;top:65%}
		</style>
	</head>
	<body>			
		<div id="topSection"><p id="title" style="display:inline-block;">LLR-TimeMachine - v0.1.0</p><div id="chipOptionHolder"><div class="chipOptions" id="chipSizeDiv"><p style="display:inline-block;">Chip Size:</p> <input id="chipSize" autocomplete="off" type="number" name="chipSize" min="115" max="255" step="10" value="195"></div><div class="chipOptions"><p style="display:inline-block;">Zoom:</p> <span class="glyphicon glyphicon-minus"></span> <input id="zoomSize" autocomplete="off" type="range" name="zoomSize" min="0" max="40" value="0"> <span class="glyphicon glyphicon-plus"></span></div><div class="chipOptions colorOptions"> <input id="selectedColor" autocomplete="off" type="color" name="selectedColor" value="#ED2939"><p style="display:inline-block;">Selected</p></div><div class="chipOptions colorOptions"> <input id="plotColor" autocomplete="off" type="color" name="plotColor" value="#3EFFFF"><p style="display:inline-block;">Plot</p></div></div> <button id="btnTsGuide" type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#chronoGuideModal">Help</button></div><div id="containerDiv" style="height:320px"><div id="plotSelectionDiv" class="sectionDiv" style="min-width:40px; width:40px;"><p class="header">Plots</p><ul id="plotList"></ul></div><div id="plot" class="sectionDiv"><p class="header">Spectral Trajectory</p> <svg id="svg" height="265"></svg><div class="btn-group" role="group" aria-label="..." style="margin:-1px; display: inline-block;"><div class="btn-group dropdown" role="group"> <button id="btnIndex" class="btn btn-default dropdown-toggle specPlotBtn" type="button"><div><strong>Index</strong>:<br><small>TC Wetness</small><span class="caret"></span></div> </button><ul class="dropdown-menu plot" id="index-list"><li href="#" id="TCB">TC Brightness</li><li href="#" id="TCG">TC Greenness</li><li class="active" href="#" id="TCW">TC Wetness</li><li href="#" id="TCA">TC Angle</li></ul></div><div id="btnRed" class="btn-group dropdown" role="group" style="display:none"> <button class="btn btn-default dropdown-toggle specPlotBtn" type="button"><div><strong>R</strong><small>GB</small>:<br><small>TC Brightness</small><span class="caret"></span></div> </button><ul class="dropdown-menu plot" id="red-list"><li class="active" href="#" id="TCB">TC Brightness</li><li href="#" id="TCG">TC Greenness</li><li href="#" id="TCW">TC Wetness</li><li href="#" id="TCA">TC Angle</li></ul></div><div class="btn-group dropdown" role="group" style="display:none"> <button id="btnGreen" class="btn btn-default dropdown-toggle specPlotBtn" type="button"><div><small>R</small><strong>G</strong><small>B</small>:<br><small>TC Greenness</small><span class="caret"></span></div> </button><ul class="dropdown-menu plot" id="green-list"><li href="#" id="TCB">TC Brightness</li><li class="active" href="#" id="TCG">TC Greenness</li><li href="#" id="TCW">TC Wetness</li><li href="#" id="TCA">TC Angle</li></ul></div><div class="btn-group dropdown" role="group" style="display:none"> <button id="btnBlue" class="btn btn-default dropdown-toggle specPlotBtn" type="button"><div><small>RG</small><strong>B</strong>:<br><small>TC Wetness</small><span class="caret"></span></div> </button><ul class="dropdown-menu plot" id="blue-list"><li href="#" id="TCB">TC Brightness</li><li href="#" id="TCG">TC Greenness</li><li class="active" href="#" id="TCW">TC Wetness</li><li href="#" id="TCA">TC Angle</li></ul></div><div class="btn-group" role="group"> <button id="btnLine" class="btn btn-default specPlotBtn" type="button"> <Strong>Show Line</strong><br><span id="lineDisplayThumb" class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> </button></div></div></div><div id="timeLapse" class="sectionDiv"><p class="header">Time Lapse</p><div id="tlHolder"> <canvas id="tlCanvas" width=255 height=255></canvas><div id="tlDate" style="text-align:center">&nbsp</div></div><div class="text-center"><div class="btn-group btn-group-xs" role="group" aria-label="..."> <button id="tlBackx2" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-fast-backward"></span></button> <button id="tlBack" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-step-backward"></span></button> <button id="tlPlay" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-play"></span></button> <button id="tlPause" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-pause"></span></button> <button id="tlForward" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-step-forward"></span></button> <button id="tlForwardx2" type="button" class="btn btn-default tlBtn"><span class="glyphicon glyphicon-fast-forward"></span></button></div></div></div><div id="googleMapSection" class="sectionDiv" style="min-width:400px;"><p class="header">Location</p><div id="googlemap" class="google-map" style="height:295px"></div></div></div><div id="chipGallerySection"><p class="header">Image Chip Gallery</p><div id="chip-gallery"></div></div><div id="img-gallery"></div><div id="chronoGuideModal" class="modal fade" role="dialog"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"> <button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">LLR-TimeMachine Help</h4></div><div id="chronoGuideBody" class="modal-body" style="overflow-y:scroll font-size:12px"><h5><strong>LLR-TimeMachine is a spectral chronology visualization tool for LLR outputs.</strong></h5><p>The interface includes:</p><ul><li>A spectral time series for the point in the "Spectral Trajectory" window</li><li>A time lapse series of image chips for the 127 x 127 pixels bounding each side of the selected point in the "Time Lapse" window</li><li>The location of the point and bounding rectangle in context according to layers in Google Maps ("Location" window)</li><li>A time series of image chips in the "Image Chip Gallery" window</li></ul><p> The image chips are displayed as uniformly scaled tasseled cap brightness, greenness, wetness (RGB). Areas that are colored funny are either bad data or areas where annual compositing did not result in filling all cloud and shadow holes, resulting in empty data (shown as blue)</p><p> The points in the "Spectral Trajectory" window can be displayed by any of the tasseled cap indices that LLR outputs, (use hover-drop button at the bottom). The plot will zoom in/out on the Y axis with a mouse scroll, and will pan with a left-click-hold-drag.</p><p> The "Image Chip Gallery" shows the 127 x 127 pixels surrounding the plot pixel (displayed in the "Spectral Trajectory" window) for each year in your LLR project record. Zoomed in and out of the image chips by holding the shift key and scrolling the mouse while hovering over a chip, or using the zoom slider in the top bar.</p><p> Vertices and segments can be added/removed from the spectral trajectory plot by double clicking on a point in the "Spectral Trajectory" window or an image chip in the "Image Chip Gallery" window. In a later version information about each vertex and segment will be displayed (stay tuned!).</p></div><div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div>
		<script>							
			function setChipGalleryLength(){var e=$(document).height()-$("#chip-gallery").offset().top-5;$("#chip-gallery").css("height",e)}function changeSelectedClass(e){thisCircle=$("circle.data").eq(e),thisCanvas=$(".chipHolder").eq(e);var t=thisCircle.attr("class");"data unselected"==t?(thisCircle.attr("class","data selected"),thisCanvas.addClass("selected"),changePlotLine()):(thisCircle.attr("class","data unselected"),thisCircle.css("stroke","none"),thisCanvas.removeClass("selected"),thisCanvas.css("border-color","white"),changePlotLine()),setSelectedColor()}function changePlotLine(){function e(){svg.select(".y.axis").call(yaxis),svg.selectAll("circle").attr("cy",function(e){return yscale(e[specIndex])}),svg.selectAll("#plotLine").attr("d",lineFunction(a))}var t=$("circle.selected"),a=[],i=0;for(selectedCircles=[],i;i<t.length;i++){var s=$("circle.data").index(t[i]);selectedCircles.push(s),a.push({x:data.Values[s].Year,y:data.Values[s][specIndex]})}$("#plotLine").remove(),lineGraph=svg.append("path").attr("d",lineFunction(a)).attr("id","plotLine").attr("clip-path","url(#clip)");var l=d3.behavior.zoom().y(yscale).scaleExtent([.1,5]).on("zoom",e);svg.call(l).on("dblclick.zoom",null)}function setcolor(e,t,a,i,s){var l=a[t].mean-a[t].stdev*i,o=a[t].mean+a[t].stdev*i,c=[],n=0;for(n;s>n;n++)e.Values[n][t]<l&&(e.Values[n][t]=l),e.Values[n][t]>o&&(e.Values[n][t]=o),c[n]=(e.Values[n][t]-l)/(o-l)*256;return c}function scaledRGB(e,t,a,i,s,l,o){var c=setcolor(e,t,s,l,o),n=setcolor(e,a,s,l,o),r=setcolor(e,i,s,l,o),p=[],h=0;for(h;o>h;h++)p[h]=d3.rgb(c[h],n[h],r[h]);return p}function plotInt(){function e(){svg.select(".y.axis").call(yaxis),svg.selectAll("circle").attr("cy",function(e){return yscale(e[specIndex])}),svg.selectAll("#plotLine").attr("d",lineFunction(v))}plotDrawn=1;for(var t=d3.min(data.Values,function(e){return e.Year}),a=d3.max(data.Values,function(e){return e.Year}),i=t-1,s=a+1,l=[],o=0;a-t>=o;o+=2)l.push(t+o);for(var c=[],o=t;a>=o;o++)c.push(o);var n=$("#plot").width(),r=265,p=10,h=20,d=70,m=37;xscale=d3.scale.linear().domain([i,s]).range([d,n-h]),yscale=d3.scale.linear().domain([domain[specIndex].min,domain[specIndex].max]).range([r-m,p]);var g=d3.svg.axis().scale(xscale).orient("bottom").tickValues(l).tickFormat(d3.format("d"));yaxis=d3.svg.axis().scale(yscale).orient("left");var u=d3.behavior.zoom().y(yscale).scaleExtent([1,5]).on("zoom",e);svg=d3.select("#svg"),svg.call(u).on("dblclick.zoom",null);var v=[{x:t,y:data.Values[0][specIndex]},{x:a,y:data.Values[len-1][specIndex]}];lineFunction=d3.svg.line().x(function(e){return xscale(e.x)}).y(function(e){return yscale(e.y)}).interpolate("linear");var f=svg.selectAll(".vline").data(c).enter().append("line").attr("x1",function(e){return xscale(e)}).attr("x2",function(e){return xscale(e)}).attr("y1",function(e){return-2e4}).attr("y2",function(e){return 2e4}).attr("class","vline"),y=.009*n,x=svg.selectAll(".data").data(data.Values).enter().append("circle").style("fill",function(e,t){return rgbColor[t]}).attr("cx",function(e){return xscale(e.Year)}).attr("cy",function(e){return yscale(e[specIndex])}).attr("r",y).attr("class","data unselected"),I=svg.append("path").attr("d",lineFunction(v)).attr("id","plotLine");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(r-m)+")").call(g),svg.selectAll("text").attr("y",-5).attr("x",20).attr("transform","rotate(90)"),svg.append("g").attr("class","y axis").attr("transform","translate("+d+",0)").call(yaxis),svg.append("text").attr("transform","rotate(-90)").attr("x",(r-m)/-2).attr("y",20).style("text-anchor","middle").text("TC Wetness").attr("id","specPlotIndex"),svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("x",70).attr("y",10).attr("width",n-h-d).attr("height",r-m-p),x.attr("clip-path","url(#clip)"),I.attr("clip-path","url(#clip)"),f.attr("clip-path","url(#clip)");var C=$("circle.data");C.eq(0).attr("class","data selected"),C.eq(len-1).attr("class","data selected");var L=$("circle.data.selected"),o=0;for(o;o<L.length;o++)selectedCircles.push(C.index(L[o]));"glyphicon glyphicon-thumbs-down"==$("#lineDisplayThumb").attr("class")&&($("circle.selected").css("stroke-opacity","0"),$("circle.highlight").css("stroke-opacity","0"),$("#plotLine").css("stroke-opacity","0"))}function update(e,t,a,i){function s(){svg.select(".y.axis").call(yaxis),svg.selectAll("circle").attr("cy",function(e){return yscale(e[t])}),svg.selectAll("#plotLine").attr("d",lineFunction(o))}yscale.domain([i[t].min,i[t].max]);var l=d3.behavior.zoom().y(yscale).scaleExtent([1,5]).on("zoom",s);svg.call(l).on("dblclick.zoom",null),svg.selectAll("circle.data").data(e.Values).transition().duration(500).attr("cx",function(e){return xscale(e.Year)}).attr("cy",function(e){return yscale(e[t])}).style("fill",function(e,t){return a[t]});var o=[],c=0;for(c;c<selectedCircles.length;c++){var n=selectedCircles[c];o.push({x:e.Values[n].Year,y:e.Values[n][t]})}svg.selectAll("#plotLine").transition().duration(500).attr("d",lineFunction(o)),svg.select(".y.axis").transition().duration(500).call(yaxis)}function setHighlightColor(){var e=$("#highlightColor").prop("value");$("circle.highlight").css("stroke",e),$(".chipHolder.highlight").css("border-color",e),$("tr.active").css("background-color",e)}function setSelectedColor(){var e=$("#selectedColor").prop("value");$("circle.selected").css("stroke",e),$("#plotLine").css("stroke",e),$(".chipHolder.selected").css("border-color",e)}function highlightOff(){$("circle.highlight").attr("class","data selected"),$(".chipHolder.highlight").addClass("selected").removeClass("highlight"),$("tr.active").removeClass("active").css("background-color","white"),$("circle").css("cursor","pointer"),$(".chipImg").css("cursor","pointer"),setSelectedColor()}function highlightOn(e,t){switch(e){case"vertex":var a=vertInfo[t].index;$("circle:eq("+a+")").attr("class","data highlight"),$(".chipHolder:eq("+a+")").removeClass("selected").addClass("highlight");break;case"segment":var i=vertInfo[t-1].index,s=vertInfo[t].index;$("circle:eq("+i+")").attr("class","data highlight"),$("circle:eq("+s+")").attr("class","data highlight"),$(".chipHolder:eq("+i+")").removeClass("selected").addClass("highlight"),$(".chipHolder:eq("+s+")").removeClass("selected").addClass("highlight")}$("circle").css("cursor","not-allowed"),$(".chipImg").css("cursor","not-allowed"),setHighlightColor()}function appendChips(){for(var e=0;e<n_chips;e++){chipInfo.chips.canvasIDs.push("chip"+e),chipInfo.chips.imgIDs.push("img0");var t='<div id="'+chipInfo.chips.canvasIDs[e]+'" class="chipHolder"><canvas class="chipImg" width="'+chipDisplayProps.chipSize+'" height="'+chipDisplayProps.canvasHeight+'"></canvas><div class="chipDate">'+data.Values[e].Year+"</div>";$("#chip-gallery").append(t)}$("#chip0, #chip"+(n_chips-1)).addClass("selected")}function tlPlay(){tlctx.drawImage(tlImgID,chipInfo.chips.sxZoom[timeLapseIndex],chipInfo.chips.syZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],0,0,255,255),$("#tlDate").text(data.Values[timeLapseIndex].Year),timeLapseIndex<len-1?timeLapseIndex+=1:timeLapseIndex=0}function drawTLimage(){tlctx.drawImage(tlImgID,chipInfo.chips.sxZoom[timeLapseIndex],chipInfo.chips.syZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],0,0,255,255)}function makeChipInfo(e){for(var t=document.getElementById("img0"),a=t.naturalHeight/255,i=0;i<n_chips;i++)useThisChip=i,chipInfo.chips.chipsInStrip.push(a),chipInfo.chips.useThisChip.push(useThisChip);updateChipInfo()}function updateChipInfo(){for(var e=0;e<n_chips;e++)chipInfo.chips.sxOrig[e]=chipDisplayProps.offset,chipInfo.chips.syOrig[e]=255*chipInfo.chips.useThisChip[e]+chipDisplayProps.offset,chipInfo.chips.sWidthOrig[e]=chipDisplayProps.chipSize,chipInfo.chips.sxZoom[e]=chipInfo.chips.sxOrig[e],chipInfo.chips.syZoom[e]=chipInfo.chips.syOrig[e],chipInfo.chips.sWidthZoom[e]=chipInfo.chips.sWidthOrig[e];for(var t=chipDisplayProps.halfChipSize,a=chipDisplayProps.box,e=1;maxZoom+1>e;e++)t*=.9,sAdj[e]=chipDisplayProps.halfChipSize-t,a/=.9,lwAdj[e]=a}function drawAllChips(){updateZoom();for(var e=0;e<n_chips;e++)drawOneChip(e)}function drawOneChip(e){var t=document.getElementById("img0"),a=$(".chipImg").eq(e)[0],i=a.getContext("2d");i.clearRect(0,0,a.width,a.height),i.mozImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,i.drawImage(t,chipInfo.chips.sxZoom[e],chipInfo.chips.syZoom[e],chipInfo.chips.sWidthZoom[e],chipInfo.chips.sWidthZoom[e],0,0,chipDisplayProps.chipSize,chipDisplayProps.chipSize),i.strokeStyle=chipDisplayProps.plotColor,i.lineWidth=1,i.lineCap="square",i.strokeRect(chipDisplayProps.halfChipSize-chipDisplayProps.boxZoom/2,chipDisplayProps.halfChipSize-chipDisplayProps.boxZoom/2,chipDisplayProps.boxZoom,chipDisplayProps.boxZoom)}function updateZoom(){for(var e=0;e<n_chips;e++)chipInfo.chips.sxZoom[e]=chipInfo.chips.sxOrig[e]+sAdj[chipDisplayProps.zoomLevel],chipInfo.chips.syZoom[e]=chipInfo.chips.syOrig[e]+sAdj[chipDisplayProps.zoomLevel],chipInfo.chips.sWidthZoom[e]=chipInfo.chips.sWidthOrig[e]-2*sAdj[chipDisplayProps.zoomLevel];chipDisplayProps.boxZoom=lwAdj[chipDisplayProps.zoomLevel]}function appendPlots(e){e.forEach(function(e){$("#plotList").append("<li>"+e.plotID+"</li>")})}function appendSrcImg(){for(var e=0;e<n_chips;e++){chipInfo.imgIDs[e]="img"+e;var t='<img class="chipImgSrc" id="'+chipInfo.imgIDs[e]+'"src="'+origData[e].url+'">';$("#img-gallery").append(t)}}function start(){appendPlots(allData)}function initMap(e,t){var a=new google.maps.Map(document.getElementById(e),{center:{lat:data.LatLon[0],lng:data.LatLon[1]},zoom:t,mapTypeId:google.maps.MapTypeId.TERRAIN}),i=(new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.1,map:a,center:{lat:data.LatLon[0],lng:data.LatLon[1]},radius:20}),new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0,map:a,center:{lat:data.LatLon[0],lng:data.LatLon[1]},radius:150}),{north:data.bounds[0],south:data.bounds[1],east:data.bounds[2],west:data.bounds[3]});new google.maps.Rectangle({bounds:i,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0,map:a})}var windowH=$(window).height(),windowW=$(window).width();$(window).resize(function(e){var t=$(window).height(),a=$(window).width();t!=windowH&&setChipGalleryLength(),a!=windowW&&1==plotDrawn&&($("#svg").empty(),selectedCircles=[],lineData=[],plotInt())}),$(document).ready(function(){setChipGalleryLength()});var n_stdev=2,specIndex="TCW";$(document).ready(function(){$(document).on("dblclick","circle.data, .chipImg",function(e){if(0==$("tr").hasClass("active")){e.preventDefault();var t=$(this).prop("nodeName");if("circle"==t)var a=$("circle.data").index(this);else var a=$(".chipImg").index(this);0!=a&&a!=len-1&&changeSelectedClass(a)}})});var selectedCircles=[],plotDrawn=0;$(document).ready(function(){$(".dropdown-menu li").click(function(){var e=$(this).closest("ul").attr("id"),t=$(this).attr("id"),a="#"+e+" #"+t,i="#"+e+" .active",s=$(i).attr("id"),l="#"+e+" #"+s;$(l).removeClass("active"),$(a).addClass("active"),"index-list"==e&&$("#btnIndex div").replaceWith("<div><strong>Index:</strong><br><small>"+$("#"+t).text()+'</small><span class="caret"></span></div>'),"red-list"==e&&$("#btnRed div").replaceWith("<div><strong>R</strong><small>GB</small><br><small>"+$("#"+t).text()+'</small><span class="caret"></span></div>'),"green-list"==e&&$("#btnGreen div").replaceWith("<div><small>R</small><strong>G</strong><small>B</small><br><small>"+$("#"+t).text()+'</small><span class="caret"></span></div>'),"blue-list"==e&&$("#btnBlue div").replaceWith("<div><small>RG</small><strong>B</strong><br><small>"+$("#"+t).text()+'</small><span class="caret"></span></div>');var o=$("#index-list li.active").attr("id"),c=$("#red-list li.active").attr("id"),n=$("#green-list li.active").attr("id"),r=$("#blue-list li.active").attr("id");rgbColor=scaledRGB(data,c,n,r,stretch,2,len),specIndex=o,update(data,specIndex,rgbColor,domain),$("#specPlotIndex").text($("#"+specIndex).text())})}),$("#btnLine").click(function(){"glyphicon glyphicon-thumbs-up"==$("#lineDisplayThumb").attr("class")?($("#lineDisplayThumb").removeClass("glyphicon glyphicon-thumbs-up").addClass("glyphicon glyphicon-thumbs-down"),$("circle.selected").css("stroke-opacity","0"),$("circle.highlight").css("stroke-opacity","0"),$("#plotLine").css("stroke-opacity","0")):($("#lineDisplayThumb").removeClass("glyphicon glyphicon-thumbs-down").addClass("glyphicon glyphicon-thumbs-up"),$("circle.selected").css("stroke-opacity","1"),$("circle.highlight").css("stroke-opacity","1"),$("#plotLine").css("stroke-opacity","1"))}),$("#highlightColor").change(function(){setHighlightColor()}),$("#selectedColor").change(function(){setSelectedColor()}),$("#plotColor").change(function(){chipDisplayProps.plotColor=$("#plotColor").prop("value"),drawAllChips()});var chipInfo={chips:{useThisChip:[],canvasIDs:[],imgIDs:[],sxOrig:[],syOrig:[],sWidthOrig:[],sxZoom:[],syZoom:[],sWidthZoom:[],chipsInStrip:[]}},chipDisplayProps={box:1,boxZoom:1,chipSize:195,halfChipSize:97.5,offset:30,canvasHeight:195,zoomLevel:0,plotColor:"#3EFFFF"},minZoom=0,maxZoom=40,stopZoom=40,sAdj=[0],lwAdj=[chipDisplayProps.box],zoomIn=0;$("#plotSize").change(function(){var e=$("#plotSize"),t=parseInt(e.prop("value"));switch(t%2==0&&(t+=1),t=Math.min(t,5),t=Math.max(t,1),e.prop("value",t),chipDisplayProps.box=t,$("#plotSizeList").hide(),chipDisplayProps.box){case 1:stopZoom=40;break;case 3:stopZoom=32;break;case 5:stopZoom=27}updateChipInfo(),drawAllChips()}),$("#chipSize").change(function(){var e=$("#chipSize"),t=parseInt(e.prop("value"));t%2==0&&(t+=1),t=Math.min(t,255),t=Math.max(t,115),e.prop("value",t),chipDisplayProps.chipSize=t,chipDisplayProps.halfChipSize=t/2,chipDisplayProps.offset=(255-t)/2,chipDisplayProps.canvasHeight=t,$(".chipHolder").remove(),appendChips("remote"),updateChipInfo(),drawAllChips()}),$("#zoomSize").change(function(){var e=$("#zoomSize"),t=parseInt(e.val());t>stopZoom&&(t=stopZoom),minZoom>t&&(t=minZoom),chipDisplayProps.zoomLevel=t,drawAllChips()});var timeLapseIndex=0,tlCanvasID=document.getElementById("tlCanvas"),tlctx=tlCanvasID.getContext("2d"),playTL;tlctx.clearRect(0,0,255,255),tlctx.mozImageSmoothingEnabled=!1,tlctx.msImageSmoothingEnabled=!1,tlctx.imageSmoothingEnabled=!1,$(".tlBtn").click(function(){var e=$(this).attr("id");clearInterval(playTL),"tlBackx2"==e?(timeLapseIndex+=-2,timeLapseIndex=0>timeLapseIndex?0:timeLapseIndex,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year)):"tlBack"==e&&timeLapseIndex>0?(timeLapseIndex+=-1,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year)):"tlPlay"==e?playTL=setInterval(tlPlay,300):"tlPause"==e||("tlForward"==e&&timeLapseIndex<len-1?(timeLapseIndex+=1,drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year)):"tlForwardx2"==e&&(timeLapseIndex+=2,timeLapseIndex=timeLapseIndex>len-1?len-1:timeLapseIndex)),drawTLimage(),$("#tlDate").text(data.Values[timeLapseIndex].Year)}),$(document).ready(function(){$(document).on("mousewheel","canvas",function(e){e.shiftKey&&(e.preventDefault(),zoomIn=e.deltaX<=-1||e.deltaY>=1?1:0,zoomIn>0?chipDisplayProps.zoomLevel<maxZoom&chipDisplayProps.zoomLevel<stopZoom&&chipDisplayProps.zoomLevel++:chipDisplayProps.zoomLevel>minZoom&&chipDisplayProps.zoomLevel--,$("#zoomSize").val(chipDisplayProps.zoomLevel),drawAllChips())})});var tlImgID="";$("body").on("click","#plotList li",function(){$("#plotList li").removeClass("selected"),$(this).addClass("selected"),$("#chip-gallery, #img-gallery, #svg").empty(),lineData=[],$("#plotList li").removeClass("selected"),$(this).addClass("selected");var e=$("#plotList li").index($(this));data=allData[e],$("#img-gallery").append('<img class="chipImgSrc" id="img0" src="'+data.chipStrip+'">'),len=data.Values.length,n_chips=len,appendChips("remote",drawAllChips),rgbColor=scaledRGB(data,"TCB","TCG","TCW",stretch,2,len),plotInt(),timeLapseIndex=0,$("#img-gallery").imagesLoaded(function(){makeChipInfo("ordered"),drawAllChips(),tlImgID=document.getElementById("img0"),tlctx.drawImage(tlImgID,chipInfo.chips.sxZoom[timeLapseIndex],chipInfo.chips.syZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],chipInfo.chips.sWidthZoom[timeLapseIndex],0,0,255,255),$("#tlDate").text(data.Values[timeLapseIndex].Year)}),$("#googlemap").empty(),initMap("googlemap",10)}),window.onload=start;
		</script>
	</body>
</html>